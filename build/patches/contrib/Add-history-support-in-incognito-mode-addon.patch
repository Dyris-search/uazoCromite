From: Your Name <you@example.com>
Date: Fri, 1 Apr 2022 11:00:15 +0000
Subject: Add history support in incognito mode (addon)

---
 chrome/browser/offline_pages/recent_tab_helper.cc | 5 ++++-
 chrome/browser/offline_pages/recent_tab_helper.h  | 3 +++
 2 files changed, 7 insertions(+), 1 deletion(-)

diff --git a/chrome/browser/offline_pages/recent_tab_helper.cc b/chrome/browser/offline_pages/recent_tab_helper.cc
--- a/chrome/browser/offline_pages/recent_tab_helper.cc
+++ b/chrome/browser/offline_pages/recent_tab_helper.cc
@@ -191,6 +191,7 @@ bool RecentTabHelper::EnsureInitialized() {
           ->GetOriginalProfile()
           ->GetPrefs()->GetBoolean(prefs::kIncognitoTabHistoryEnabled) == true) {
       snapshots_enabled_ = true;
+      always_incognito_mode_enabled_ = true;
     }
   }
 
@@ -469,7 +470,9 @@ void RecentTabHelper::ContinueSnapshotWithIdsToPurge(
 void RecentTabHelper::ContinueSnapshotAfterPurge(
     SnapshotProgressInfo* snapshot_info,
     OfflinePageModel::DeletePageResult result) {
-  if (result != OfflinePageModel::DeletePageResult::SUCCESS) {
+  // remove snapshot save of recent tab if always incognito mode is active
+  // so recents tab list is empty at every startup
+  if ((always_incognito_mode_enabled_) || result != OfflinePageModel::DeletePageResult::SUCCESS) {
     ReportSnapshotCompleted(snapshot_info, false);
     return;
   }
diff --git a/chrome/browser/offline_pages/recent_tab_helper.h b/chrome/browser/offline_pages/recent_tab_helper.h
--- a/chrome/browser/offline_pages/recent_tab_helper.h
+++ b/chrome/browser/offline_pages/recent_tab_helper.h
@@ -142,6 +142,9 @@ class RecentTabHelper
   // Not page-specific.
   bool snapshots_enabled_ = false;
 
+  // If true, always incognito mode is enabled
+  bool always_incognito_mode_enabled_ = false;
+
   // Snapshot progress information for an ongoing snapshot requested by
   // downloads. Null if there's no ongoing request.
   std::unique_ptr<SnapshotProgressInfo> downloads_ongoing_snapshot_info_;
--
2.25.1
